<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Content/Datas/Scripts/state-battle.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Content/Datas/Scripts/state-battle.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// -------------------------------------------------------
//
//  CLASS StateBattle : GameState
//
//  A state for battling.
//
//  @winning                        -> Boolean indicating whether the player won the battle or not
//  @troopID                        -> Current troop the allies are fighting
//  @canEscape                      -> Boolean indicating if the player can escape this battle.
//  @canGameOver                    -> Boolean indicating if there a win/lose node or not.
//  @kindSelection                  -> Indicating which group is currently selected
//  @attackingGroup                 -> Indicating which group is currently attacking
//  @step                           -> Step of the battle
//  @subStep                        -> sub-step of the battle (usefull for menus or other sub-steps)
//  @selectedUserIndex              -> Index of the selected user
//  @selectedTargetIndex            -> Index of the selected target
//  @distanceCenterAlly             -> The distance between the center of map battle and ally
//  @time                           -> Chrono
//  @targets                        -> List of all the current targets
//  @battlers                       -> Battlers of all the allies/enemies
//  @windowTopInformations          -> The window on top that shows specific informations
//  @windowCharacterInformations    -> The window on bot that shows caracteristics informations
//  @windowChoicesBattleCommands    -> The window for battle commands
//  @arrowSelection                 -> The arrow used to select allies/ennemies
//  @textsDamages                   -> List of all the damages to display
//
// -------------------------------------------------------

/** @class
*   A state for battling.
*   @extends GameState
*   @property {boolean} winning Boolean indicating whether the player won the battle or not.
*   @property {number} troopID Current troop the allies are fighting.
*   @property {boolean} canEscape Boolean indicating if the player can escape this battle.
*   @property {boolean} canGameOver Boolean indicating if there a win/lose node or not.
*   @property {CharacterKind} kindSelection Indicating which group is currently selected.
*   @property {CharacterKind} attackingGroup Indicating which group is currently attacking.
*   @property {number} step Step of the battle.
*   @property {number} subStep Sub-step of the battle (usefull for menus or other sub-steps).
*   @property {number} selectedUserIndex Index of the selected user.
*   @property {number} distanceCenterAlly The distance between the center of map battle and ally.
*   @property {number} time A chronometer.
*   @property {OwnedCharacter[]} targets List of all the current targets.
*   @property {Array.&lt;Array.&lt;OwnedCharacter>>} battlers Battlers of all the allies/enemies.
*/
function StateBattle(troopID, canGameOver, canEscape) {
    GameState.call(this);
    this.step = 0;
    this.troopID = troopID;
    this.canGameOver = canGameOver;
    this.canEscape = canEscape;
    this.initialize();
}

StateBattle.prototype = {

    activeGroup: function(){
        var i, l;
        for (i = 0, l = this.battlers[this.attackingGroup].length; i &lt; l; i++){
            this.battlers[this.attackingGroup][i].active = true;
        }
    },

    // -------------------------------------------------------

    isDefined: function(kind, index){
        return (this.battlers[kind][index].active &amp;&amp; !this.battlers[kind][index].character.isDead())
    },

    // -------------------------------------------------------
    // When all the heroes or enemies are inactive

    isEndTurn: function(){
        var i, l;

        for (i = 0, l = this.battlers[this.attackingGroup].length; i &lt; l; i++){
            if (this.isDefined(this.attackingGroup, i)) return false;
        }

        return true;
    },

    // -------------------------------------------------------

    isGroupDead: function(group){
        var i, l;

        for (i = 0, l = this.battlers[group].length; i &lt; l; i++){
            if (!this.battlers[group][i].character.isDead()) return false;
        }

        return true;
    },

    // -------------------------------------------------------
    // When all the enemies are dead

    isWin: function(){
        return this.isGroupDead(CharacterKind.Monster);
    },

    // -------------------------------------------------------
    //  When all the heroes are dead

    isLose: function(){
        return this.isGroupDead(CharacterKind.Hero);
    },

    // -------------------------------------------------------

    gameOver: function(){
        if (this.canGameOver){
            quit(); // TODO
        }
        else
            $gameStack.shift();
    },

    // -------------------------------------------------------

    win: function(){
        this.winning = true;
        $gameStack.shift();
    },

    // -------------------------------------------------------

    changeStep: function(i){
        this.step = i;
        this.subStep = 0;
        this.initialize();
    },

    // -------------------------------------------------------

    initialize: function(){
        switch(this.step){
        case 0:
            this.initializeStep0(); break;
        case 1:
            this.initializeStep1(); break;
        case 2:
            this.initializeStep2(); break;
        case 3:
            this.initializeStep3(); break;
        case 4:
            this.initializeStep4(); break;
        }
    },

    // -------------------------------------------------------

    update: function(){
        switch(this.step){
        case 0:
            this.updateStep0(); break;
        case 1:
            this.updateStep1(); break;
        case 2:
            this.updateStep2(); break;
        case 3:
            this.updateStep3(); break;
        case 4:
            this.updateStep4(); break;
        }
    },

    // -------------------------------------------------------

    onKeyPressed: function(key){
        switch(this.step){
        case 0:
            this.onKeyPressedStep0(key); break;
        case 1:
            this.onKeyPressedStep1(key); break;
        case 2:
            this.onKeyPressedStep2(key); break;
        case 3:
            this.onKeyPressedStep3(key); break;
        case 4:
            this.onKeyPressedStep4(key); break;
        }
    },

    // -------------------------------------------------------

    onKeyReleased: function(key){
        switch(this.step){
        case 0:
            this.onKeyReleasedStep0(key); break;
        case 1:
            this.onKeyReleasedStep1(key); break;
        case 2:
            this.onKeyReleasedStep2(key); break;
        case 3:
            this.onKeyReleasedStep3(key); break;
        case 4:
            this.onKeyReleasedStep4(key); break;
        }
    },

    // -------------------------------------------------------

    onKeyPressedRepeat: function(key){
        switch(this.step){
        case 0:
            this.onKeyPressedRepeatStep0(key); break;
        case 1:
            this.onKeyPressedRepeatStep1(key); break;
        case 2:
            this.onKeyPressedRepeatStep2(key); break;
        case 3:
            this.onKeyPressedRepeatStep3(key); break;
        case 4:
            this.onKeyPressedRepeatStep4(key); break;
        }
    },

    // -------------------------------------------------------

    onKeyPressedAndRepeat: function(key){
        switch(this.step){
        case 0:
            this.onKeyPressedAndRepeatStep0(key); break;
        case 1:
            this.onKeyPressedAndRepeatStep1(key); break;
        case 2:
            this.onKeyPressedAndRepeatStep2(key); break;
        case 3:
            this.onKeyPressedAndRepeatStep3(key); break;
        case 4:
            this.onKeyPressedAndRepeatStep4(key); break;
        }
    },

    // -------------------------------------------------------

    drawBattlers: function(context){
        var i, l;

        for (i = 0, l = this.battlers[CharacterKind.Hero].length; i &lt; l; i++){
            if (!this.battlers[CharacterKind.Hero][i].character.isDead())
                this.battlers[CharacterKind.Hero][i].draw(context);
        }
        for (i = 0, l = this.battlers[CharacterKind.Monster].length; i &lt; l; i++){
            if (!this.battlers[CharacterKind.Monster][i].character.isDead())
                this.battlers[CharacterKind.Monster][i].draw(context);
        }
    },

    // -------------------------------------------------------

    draw3D: function(canvas){
        switch(this.step){
        case 0:
            this.draw3DStep0(canvas); break;
        case 1:
            this.draw3DStep1(canvas); break;
        case 2:
            this.draw3DStep2(canvas); break;
        case 3:
            this.draw3DStep3(canvas); break;
        case 4:
            this.draw3DStep4(canvas); break;
        }
    },

    // -------------------------------------------------------

    drawHUD: function(context){
        switch(this.step){
        case 0:
            this.drawHUDStep0(context); break;
        case 1:
            this.drawHUDStep1(context); break;
        case 2:
            this.drawHUDStep2(context); break;
        case 3:
            this.drawHUDStep3(context); break;
        case 4:
            this.drawHUDStep4(context); break;
        }
    }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Battler.html">Battler</a></li><li><a href="Bitmap.html">Bitmap</a></li><li><a href="Class.html">Class</a></li><li><a href="DatasArmors.html">DatasArmors</a></li><li><a href="GameStack.html">GameStack</a></li><li><a href="StateBattle.html">StateBattle</a></li><li><a href="SystemArmor.html">SystemArmor</a></li><li><a href="WindowBattle.html">WindowBattle</a></li></ul><h3>Global</h3><ul><li><a href="global.html#$blockingHero">$blockingHero</a></li><li><a href="global.html#$canvasHeight">$canvasHeight</a></li><li><a href="global.html#$canvasHUD">$canvasHUD</a></li><li><a href="global.html#$canvasWidth">$canvasWidth</a></li><li><a href="global.html#$datasGame">$datasGame</a></li><li><a href="global.html#$DESKTOP">$DESKTOP</a></li><li><a href="global.html#$elapsedTime">$elapsedTime</a></li><li><a href="global.html#$filesToLoad">$filesToLoad</a></li><li><a href="global.html#$fontName">$fontName</a></li><li><a href="global.html#$fontSize">$fontSize</a></li><li><a href="global.html#$game">$game</a></li><li><a href="global.html#$gameStack">$gameStack</a></li><li><a href="global.html#$keysPressed">$keysPressed</a></li><li><a href="global.html#$loadedFiles">$loadedFiles</a></li><li><a href="global.html#$modelHero">$modelHero</a></li><li><a href="global.html#$PORTION_SIZE">$PORTION_SIZE</a></li><li><a href="global.html#$PORTIONS_RAY_FAR">$PORTIONS_RAY_FAR</a></li><li><a href="global.html#$PORTIONS_RAY_NEAR">$PORTIONS_RAY_NEAR</a></li><li><a href="global.html#$renderer">$renderer</a></li><li><a href="global.html#$ROOT_DIRECTORY">$ROOT_DIRECTORY</a></li><li><a href="global.html#$SCREEN_X">$SCREEN_X</a></li><li><a href="global.html#$SCREEN_Y">$SCREEN_Y</a></li><li><a href="global.html#$SQUARE_SIZE">$SQUARE_SIZE</a></li><li><a href="global.html#$windowX">$windowX</a></li><li><a href="global.html#$windowY">$windowY</a></li><li><a href="global.html#draw3D">draw3D</a></li><li><a href="global.html#drawHUD">drawHUD</a></li><li><a href="global.html#getCorrectedKey">getCorrectedKey</a></li><li><a href="global.html#initialize">initialize</a></li><li><a href="global.html#initializeGL">initializeGL</a></li><li><a href="global.html#ItemKind">ItemKind</a></li><li><a href="global.html#onKeyPressed">onKeyPressed</a></li><li><a href="global.html#onKeyPressedAndRepeat">onKeyPressedAndRepeat</a></li><li><a href="global.html#onKeyPressedRepeat">onKeyPressedRepeat</a></li><li><a href="global.html#onKeyReleased">onKeyReleased</a></li><li><a href="global.html#quit">quit</a></li><li><a href="global.html#resizeGL">resizeGL</a></li><li><a href="global.html#THREE">THREE</a></li><li><a href="global.html#update">update</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Sun Jun 04 2017 21:54:06 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
